# ğŸ“Š Visual Diagrams & Architecture Guide

## Quick Reference Visual Guide for Interview Prep

---

## 1. Complete System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER LAYER                                  â”‚
â”‚  ğŸ‘¤ User â†’ Browser â†’ localhost:8501 (Streamlit UI)                 â”‚
â”‚     â”œâ”€ Upload sketch.png                                           â”‚
â”‚     â”œâ”€ Enter text prompt: "futuristic cyberpunk city"              â”‚
â”‚     â””â”€ Click "Run RAG Pipeline"                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ HTTP POST multipart/form-data
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      NETWORKING LAYER                               â”‚
â”‚  ğŸŒ Ngrok Tunnel â†’ https://xxxx.ngrok-free.app                     â”‚
â”‚     â”œâ”€ Bypasses Colab's lack of public IP                         â”‚
â”‚     â”œâ”€ Header: ngrok-skip-browser-warning: true                   â”‚
â”‚     â””â”€ SSL: Self-signed cert (verify=False)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ Forwards to localhost:8000
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         API LAYER                                   â”‚
â”‚  âš¡ FastAPI + Uvicorn (ASGI Server)                                â”‚
â”‚     â”œâ”€ Endpoint: POST /generate                                    â”‚
â”‚     â”œâ”€ Params: file (UploadFile), prompt (str)                     â”‚
â”‚     â”œâ”€ Async I/O for file handling                                 â”‚
â”‚     â””â”€ Returns: PNG image + X-Retrieved-Style header               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     RETRIEVAL LAYER          â”‚  â”‚   PREPROCESSING LAYER        â”‚
â”‚  ğŸ” LangChain + ChromaDB     â”‚  â”‚  ğŸ–¼ï¸ OpenCV + PIL            â”‚
â”‚                              â”‚  â”‚                              â”‚
â”‚  1. CLIP Text Encoder        â”‚  â”‚  1. Load sketch image        â”‚
â”‚     "cyberpunk city"         â”‚  â”‚     sketch.png (RGB)         â”‚
â”‚     â†“                        â”‚  â”‚     â†“                        â”‚
â”‚  2. Embed to 512-dim         â”‚  â”‚  2. Convert to grayscale     â”‚
â”‚     [0.23, -0.45, ...]       â”‚  â”‚     cv2.cvtColor()           â”‚
â”‚     â†“                        â”‚  â”‚     â†“                        â”‚
â”‚  3. Cosine similarity search â”‚  â”‚  3. Canny edge detection     â”‚
â”‚     ChromaDB query()         â”‚  â”‚     cv2.Canny(50, 150)       â”‚
â”‚     â†“                        â”‚  â”‚     â†“                        â”‚
â”‚  4. Retrieve best match      â”‚  â”‚  4. Convert to 3-channel     â”‚
â”‚     Cyberpunk.jpg (0.87)     â”‚  â”‚     np.stack([edges]*3)      â”‚
â”‚     â†“                        â”‚  â”‚     â†“                        â”‚
â”‚  5. Return metadata          â”‚  â”‚  5. Convert to PIL Image     â”‚
â”‚     path: styles/Cyber.jpg   â”‚  â”‚     canny_image.png          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      GENERATION LAYER                               â”‚
â”‚  ğŸ¨ Stable Diffusion 1.5 + ControlNet + IP-Adapter                 â”‚
â”‚                                                                     â”‚
â”‚  Inputs:                                                            â”‚
â”‚  â”œâ”€ Text prompt: "futuristic cyberpunk city"                       â”‚
â”‚  â”œâ”€ Edge map: canny_image.png (ControlNet conditioning)            â”‚
â”‚  â””â”€ Style ref: Cyberpunk.jpg (IP-Adapter conditioning)             â”‚
â”‚                                                                     â”‚
â”‚  Pipeline:                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ 1. Initialize random noise (64Ã—64Ã—4 latent)       â”‚            â”‚
â”‚  â”‚                                                    â”‚            â”‚
â”‚  â”‚ 2. For t in [T=20, 19, ..., 1]:                   â”‚            â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚            â”‚
â”‚  â”‚    â”‚ a. Text Encoder (CLIP)             â”‚         â”‚            â”‚
â”‚  â”‚    â”‚    prompt â†’ cross-attention keys    â”‚         â”‚            â”‚
â”‚  â”‚    â”‚                                     â”‚         â”‚            â”‚
â”‚  â”‚    â”‚ b. ControlNet                       â”‚         â”‚            â”‚
â”‚  â”‚    â”‚    canny_image â†’ encoder features   â”‚         â”‚            â”‚
â”‚  â”‚    â”‚    inject via zero convolutions     â”‚         â”‚            â”‚
â”‚  â”‚    â”‚                                     â”‚         â”‚            â”‚
â”‚  â”‚    â”‚ c. IP-Adapter                       â”‚         â”‚            â”‚
â”‚  â”‚    â”‚    Cyberpunk.jpg â†’ CLIP encoding    â”‚         â”‚            â”‚
â”‚  â”‚    â”‚    modify attention K/V             â”‚         â”‚            â”‚
â”‚  â”‚    â”‚                                     â”‚         â”‚            â”‚
â”‚  â”‚    â”‚ d. U-Net Forward Pass               â”‚         â”‚            â”‚
â”‚  â”‚    â”‚    Input: current latent            â”‚         â”‚            â”‚
â”‚  â”‚    â”‚    Conditioning: [text, struct, style]â”‚       â”‚            â”‚
â”‚  â”‚    â”‚    Output: predicted noise Îµ        â”‚         â”‚            â”‚
â”‚  â”‚    â”‚                                     â”‚         â”‚            â”‚
â”‚  â”‚    â”‚ e. Denoising Step                   â”‚         â”‚            â”‚
â”‚  â”‚    â”‚    latent = (latent - Îµ) / sqrt(Î±) â”‚         â”‚            â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚            â”‚
â”‚  â”‚                                                    â”‚            â”‚
â”‚  â”‚ 3. VAE Decoder                                    â”‚            â”‚
â”‚  â”‚    latent (64Ã—64Ã—4) â†’ image (512Ã—512Ã—3)          â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                     â”‚
â”‚  Output: final_image.png                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ Serialize to PNG bytes
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     RESPONSE LAYER                                  â”‚
â”‚  ğŸ“¤ HTTP Response                                                   â”‚
â”‚     â”œâ”€ Status: 200 OK                                              â”‚
â”‚     â”œâ”€ Content-Type: image/png                                     â”‚
â”‚     â”œâ”€ Headers: X-Retrieved-Style: "Cyberpunk"                     â”‚
â”‚     â””â”€ Body: PNG binary data (512Ã—512Ã—3)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ HTTP Response
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DISPLAY LAYER                                  â”‚
â”‚  ğŸ–¼ï¸ Streamlit Result Visualization                                â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚     â”‚ Column 1    â”‚ Column 2         â”‚ Column 3        â”‚          â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
â”‚     â”‚ Input       â”‚ Retrieved Style  â”‚ Generated       â”‚          â”‚
â”‚     â”‚ sketch.png  â”‚ Cyberpunk.jpg    â”‚ final_image.png â”‚          â”‚
â”‚     â”‚             â”‚ (from header)    â”‚ (from body)     â”‚          â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. RAG Pipeline Deep Dive

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  INDEXING PHASE (One-Time Setup)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Style Images:
  â”œâ”€ Cyberpunk.jpg (https://unsplash.com/...)
  â”œâ”€ Ghibli.jpg
  â”œâ”€ Industrial.jpg
  â””â”€ Sketch.jpg

        â”‚ Download
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CLIP Image Encoder â”‚  (Vision Transformer ViT-B/32)
â”‚                    â”‚
â”‚ Input: Image       â”‚
â”‚ â”œâ”€ Split into      â”‚
â”‚ â”‚  32Ã—32 patches   â”‚
â”‚ â”œâ”€ Linear embed    â”‚
â”‚ â”œâ”€ Add positional  â”‚
â”‚ â”‚  encoding        â”‚
â”‚ â”œâ”€ 12 transformer  â”‚
â”‚ â”‚  layers          â”‚
â”‚ â””â”€ [CLS] token     â”‚
â”‚    extraction      â”‚
â”‚                    â”‚
â”‚ Output: 512-dim    â”‚
â”‚ embedding vector   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ L2 Normalize
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ChromaDB Vector Storage                     â”‚
â”‚                                             â”‚
â”‚ Collection: "langchain_styles"              â”‚
â”‚                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ID: "Cyberpunk"                         â”‚ â”‚
â”‚ â”‚ Embedding: [0.23, -0.45, 0.67, ...]    â”‚ â”‚ 512 dimensions
â”‚ â”‚ Metadata: {"path": "styles/Cyber.jpg"} â”‚ â”‚
â”‚ â”‚ Document: "Cyberpunk"                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ID: "Ghibli"                            â”‚ â”‚
â”‚ â”‚ Embedding: [-0.15, 0.32, -0.21, ...]   â”‚ â”‚
â”‚ â”‚ Metadata: {"path": "styles/Ghibli.jpg"}â”‚ â”‚
â”‚ â”‚ Document: "Ghibli"                     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                             â”‚
â”‚ (+ 2 more styles)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   RETRIEVAL PHASE (Runtime)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User Query: "futuristic neon city lights"

        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CLIP Text Encoder  â”‚  (Text Transformer)
â”‚                    â”‚
â”‚ Input: Text        â”‚
â”‚ â”œâ”€ Tokenize        â”‚
â”‚ â”‚  (BPE)           â”‚
â”‚ â”œâ”€ Token embedding â”‚
â”‚ â”œâ”€ Positional      â”‚
â”‚ â”‚  encoding        â”‚
â”‚ â”œâ”€ 12 transformer  â”‚
â”‚ â”‚  layers          â”‚
â”‚ â””â”€ [CLS] token     â”‚
â”‚    extraction      â”‚
â”‚                    â”‚
â”‚ Output: 512-dim    â”‚
â”‚ embedding vector   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ L2 Normalize
        â–¼
  Query Vector: [0.21, -0.43, 0.69, ...]

        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Similarity Search (ChromaDB)                â”‚
â”‚                                             â”‚
â”‚ For each stored embedding:                  â”‚
â”‚                                             â”‚
â”‚ similarity = cosine_similarity(query, db)   â”‚
â”‚            = (query Â· db) / (||query|| Ã— ||db||) â”‚
â”‚                                             â”‚
â”‚ Results:                                    â”‚
â”‚ â”œâ”€ Cyberpunk:   0.87  â† HIGHEST            â”‚
â”‚ â”œâ”€ Industrial:  0.52                        â”‚
â”‚ â”œâ”€ Ghibli:      0.34                        â”‚
â”‚ â””â”€ Sketch:      0.21                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ Return top-1
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Retrieved Document                     â”‚
â”‚                                        â”‚
â”‚ ID: "Cyberpunk"                        â”‚
â”‚ Similarity: 0.87                       â”‚
â”‚ Metadata: {                            â”‚
â”‚   "path": "styles/Cyberpunk.jpg"       â”‚
â”‚ }                                      â”‚
â”‚ Document: "Cyberpunk"                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â””â”€â†’ Pass to Generation Pipeline
```

---

## 3. LangChain LCEL Chain Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  LANGCHAIN EXPRESSION LANGUAGE (LCEL)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

INPUT DICTIONARY:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ {                             â”‚
â”‚   "prompt": "neon city",      â”‚
â”‚   "sketch": PIL.Image         â”‚
â”‚ }                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ Pass through
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RunnablePassthrough.assign(style_path=retrieve_step)                â”‚
â”‚                                                                     â”‚
â”‚ What it does:                                                       â”‚
â”‚ 1. Takes input dict                                                 â”‚
â”‚ 2. Keeps all existing fields (prompt, sketch)                      â”‚
â”‚ 3. Adds new field: style_path                                      â”‚
â”‚                                                                     â”‚
â”‚ retrieve_step(prompt):                                              â”‚
â”‚   â”œâ”€ retriever.invoke("neon city")                                 â”‚
â”‚   â”œâ”€ CLIP embeds text                                              â”‚
â”‚   â”œâ”€ ChromaDB searches                                             â”‚
â”‚   â””â”€ Returns: "styles/Cyberpunk.jpg"                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ Output
        â–¼
INTERMEDIATE DICTIONARY:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ {                             â”‚
â”‚   "prompt": "neon city",      â”‚
â”‚   "sketch": PIL.Image,        â”‚
â”‚   "style_path": "styles/      â”‚
â”‚                 Cyberpunk.jpg"â”‚  â† NEW FIELD
â”‚ }                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ Pipe to next step (| operator)
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RunnableLambda(generation_node)                                     â”‚
â”‚                                                                     â”‚
â”‚ generation_node(inputs):                                            â”‚
â”‚   â”œâ”€ Extract: prompt, sketch, style_path                           â”‚
â”‚   â”œâ”€ Load style image from style_path                              â”‚
â”‚   â”œâ”€ Canny edge detection on sketch                                â”‚
â”‚   â”œâ”€ Stable Diffusion inference:                                   â”‚
â”‚   â”‚   â”œâ”€ Text: prompt (cross-attention)                            â”‚
â”‚   â”‚   â”œâ”€ Structure: canny_edges (ControlNet)                       â”‚
â”‚   â”‚   â””â”€ Style: style_image (IP-Adapter)                           â”‚
â”‚   â””â”€ Return: PIL.Image (generated)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ Output
        â–¼
FINAL OUTPUT:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PIL.Image                     â”‚
â”‚ (512Ã—512Ã—3 RGB image)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EQUIVALENT CODE (Without LCEL)                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚ def manual_chain(inputs):                                           â”‚
â”‚     # Step 1: Retrieve                                              â”‚
â”‚     docs = retriever.invoke(inputs["prompt"])                       â”‚
â”‚     style_path = docs[0].metadata["path"]                           â”‚
â”‚                                                                     â”‚
â”‚     # Step 2: Add to inputs                                         â”‚
â”‚     inputs["style_path"] = style_path                               â”‚
â”‚                                                                     â”‚
â”‚     # Step 3: Generate                                              â”‚
â”‚     result = generation_node(inputs)                                â”‚
â”‚                                                                     â”‚
â”‚     return result                                                   â”‚
â”‚                                                                     â”‚
â”‚ # LCEL is just syntactic sugar for this!                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Stable Diffusion U-Net Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STABLE DIFFUSION U-NET                           â”‚
â”‚            (with ControlNet + IP-Adapter Conditioning)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

INPUTS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Noisy Latent         â”‚  â”‚ Text Prompt      â”‚  â”‚ Timestep t      â”‚
â”‚ z_t (64Ã—64Ã—4)        â”‚  â”‚ "neon city"      â”‚  â”‚ e.g., t=15/20   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                          â”‚                      â”‚
        â”‚                          â–¼                      â”‚
        â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
        â”‚                  â”‚ CLIP Text Encoderâ”‚          â”‚
        â”‚                  â”‚ 77 tokens Ã— 768d â”‚          â”‚
        â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
        â”‚                          â”‚                      â”‚
        â”‚                          â”‚                      â”‚
SIDE INPUTS:                       â”‚                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚                      â”‚
â”‚ Canny Edges      â”‚               â”‚                      â”‚
â”‚ (ControlNet)     â”‚               â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚                      â”‚
        â”‚                          â”‚                      â”‚
        â–¼                          â”‚                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚                      â”‚
â”‚ ControlNet Encoder â”‚             â”‚                      â”‚
â”‚ (Copy of U-Net)    â”‚             â”‚                      â”‚
â”‚ â”œâ”€ Conv (64Ã—64)    â”‚             â”‚                      â”‚
â”‚ â”œâ”€ Down (32Ã—32)    â”‚             â”‚                      â”‚
â”‚ â”œâ”€ Down (16Ã—16)    â”‚             â”‚                      â”‚
â”‚ â””â”€ Down (8Ã—8)      â”‚             â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚                      â”‚
        â”‚                          â”‚                      â”‚
        â”‚ Zero Conv (starts at 0)  â”‚                      â”‚
        â”‚                          â”‚                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚                      â”‚
                   â”‚               â”‚                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚                      â”‚
â”‚ Style Image      â”‚               â”‚                      â”‚
â”‚ (IP-Adapter)     â”‚               â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚                      â”‚
        â”‚                          â”‚                      â”‚
        â–¼                          â”‚                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚                      â”‚
â”‚ CLIP Image Encoder â”‚             â”‚                      â”‚
â”‚ 512-dim features   â”‚             â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚                      â”‚
        â”‚                          â”‚                      â”‚
        â”‚ Modify Attention K/V     â”‚                      â”‚
        â”‚                          â”‚                      â”‚
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â”‚                        U-NET FORWARD PASS                            â”‚
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ ENCODER (Downsampling)                 â”‚
        â”‚                                        â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚ â”‚ ResBlock + Self-Attention (64Ã—64)  â”‚ â”‚
        â”‚ â”‚ â”œâ”€ Timestep embedding injected     â”‚ â”‚
        â”‚ â”‚ â””â”€ Skip connection saved           â”‚ â”‚ â”€â”€â”€â”
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
        â”‚          â”‚ + ControlNet features       â”‚    â”‚
        â”‚          â–¼                             â”‚    â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
        â”‚ â”‚ Downsample (32Ã—32)                 â”‚ â”‚    â”‚
        â”‚ â”‚ ResBlock + Self-Attention          â”‚ â”‚    â”‚ Skip
        â”‚ â”‚ â””â”€ Skip connection saved           â”‚ â”‚ â”€â”€â”€â”¤ Connections
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
        â”‚          â”‚ + ControlNet features       â”‚    â”‚
        â”‚          â–¼                             â”‚    â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
        â”‚ â”‚ Downsample (16Ã—16)                 â”‚ â”‚    â”‚
        â”‚ â”‚ ResBlock + Self-Attention          â”‚ â”‚    â”‚
        â”‚ â”‚ â””â”€ Skip connection saved           â”‚ â”‚ â”€â”€â”€â”¤
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
        â”‚          â”‚ + ControlNet features       â”‚    â”‚
        â”‚          â–¼                             â”‚    â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
        â”‚ â”‚ Downsample (8Ã—8)                   â”‚ â”‚    â”‚
        â”‚ â”‚ ResBlock + Self-Attention          â”‚ â”‚    â”‚
        â”‚ â”‚ â””â”€ Skip connection saved           â”‚ â”‚ â”€â”€â”€â”˜
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ BOTTLENECK (8Ã—8)                       â”‚
        â”‚                                        â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚ â”‚ ResBlock                           â”‚ â”‚
        â”‚ â”‚ â”œâ”€ Self-Attention                  â”‚ â”‚
        â”‚ â”‚ â””â”€ Cross-Attention                 â”‚ â”‚
        â”‚ â”‚    â”œâ”€ Q: From latent features      â”‚ â”‚
        â”‚ â”‚    â”œâ”€ K: [Text; Style] â† IP-Adapterâ”‚ â”‚
        â”‚ â”‚    â””â”€ V: [Text; Style] â† IP-Adapterâ”‚ â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ DECODER (Upsampling)                   â”‚
        â”‚                                        â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚ â”‚ Upsample (16Ã—16)                   â”‚ â”‚
        â”‚ â”‚ Concatenate skip connection â†â”€â”€â”€â”€â”€â”€â”¼â”€â”¤
        â”‚ â”‚ ResBlock + Self-Attention          â”‚ â”‚
        â”‚ â”‚ Cross-Attention (text + style)     â”‚ â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚          â–¼                             â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚ â”‚ Upsample (32Ã—32)                   â”‚ â”‚
        â”‚ â”‚ Concatenate skip connection â†â”€â”€â”€â”€â”€â”€â”¼â”€â”¤
        â”‚ â”‚ ResBlock + Self-Attention          â”‚ â”‚
        â”‚ â”‚ Cross-Attention (text + style)     â”‚ â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚          â–¼                             â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚ â”‚ Upsample (64Ã—64)                   â”‚ â”‚
        â”‚ â”‚ Concatenate skip connection â†â”€â”€â”€â”€â”€â”€â”¼â”€â”¤
        â”‚ â”‚ ResBlock + Self-Attention          â”‚ â”‚
        â”‚ â”‚ Cross-Attention (text + style)     â”‚ â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ OUTPUT PROJECTION                      â”‚
        â”‚ Conv (64Ã—64Ã—4)                         â”‚
        â”‚ Predicted noise: Îµ_Î¸(z_t, t, c)       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        DENOISING STEP:
        z_{t-1} = (z_t - sqrt(1-Î±_t) Ã— Îµ_Î¸) / sqrt(Î±_t)
```

---

## 5. Data Flow Timeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GENERATION TIMELINE                              â”‚
â”‚                  (Total: ~15 seconds on T4)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

T = 0ms
  â”œâ”€ User clicks "Generate"
  â”‚
T = 100ms
  â”œâ”€ HTTP request reaches backend
  â”œâ”€ FastAPI parses multipart form
  â”‚  â”œâ”€ file: 2MB image data
  â”‚  â””â”€ prompt: "futuristic neon city"
  â”‚
T = 150ms
  â”œâ”€ Load sketch into PIL Image (50ms)
  â”‚
T = 200ms
  â”œâ”€ RAG RETRIEVAL PHASE
  â”‚  â”œâ”€ CLIP text embedding (50ms)
  â”‚  â”‚  â””â”€ prompt â†’ [0.21, -0.43, 0.69, ...]
  â”‚  â””â”€ ChromaDB search (50ms)
  â”‚     â””â”€ cosine similarity â†’ "Cyberpunk"
  â”‚
T = 300ms
  â”œâ”€ PREPROCESSING PHASE
  â”‚  â”œâ”€ Canny edge detection (50ms)
  â”‚  â”‚  â”œâ”€ RGB â†’ Grayscale
  â”‚  â”‚  â”œâ”€ Gradient computation
  â”‚  â”‚  â”œâ”€ Non-maximum suppression
  â”‚  â”‚  â””â”€ Edge tracking
  â”‚  â””â”€ Load style image (50ms)
  â”‚     â””â”€ Cyberpunk.jpg â†’ PIL Image
  â”‚
T = 400ms - 15s
  â”œâ”€ GENERATION PHASE (14.6 seconds)
  â”‚  â”‚
  â”‚  â”œâ”€ Model initialization (already loaded at startup)
  â”‚  â”‚
  â”‚  â”œâ”€ Encode style image (200ms)
  â”‚  â”‚  â””â”€ CLIP image encoder â†’ 512-dim
  â”‚  â”‚
  â”‚  â”œâ”€ Encode text prompt (100ms)
  â”‚  â”‚  â””â”€ CLIP text encoder â†’ 77Ã—768
  â”‚  â”‚
  â”‚  â”œâ”€ Process ControlNet condition (100ms)
  â”‚  â”‚  â””â”€ Canny edges â†’ ControlNet encoder
  â”‚  â”‚
  â”‚  â”œâ”€ Initialize latent (10ms)
  â”‚  â”‚  â””â”€ z_T ~ N(0, I) shape (64Ã—64Ã—4)
  â”‚  â”‚
  â”‚  â”œâ”€ DIFFUSION LOOP (20 steps Ã— 700ms = 14s)
  â”‚  â”‚  â”‚
  â”‚  â”‚  For t in [20, 19, ..., 1]:
  â”‚  â”‚  â”‚
  â”‚  â”‚  â”œâ”€ Step 20: Denoise from pure noise (700ms)
  â”‚  â”‚  â”‚  â”œâ”€ U-Net forward pass (600ms)
  â”‚  â”‚  â”‚  â”‚  â”œâ”€ Encoder with ControlNet injection
  â”‚  â”‚  â”‚  â”‚  â”œâ”€ Bottleneck with IP-Adapter attention
  â”‚  â”‚  â”‚  â”‚  â””â”€ Decoder with skip connections
  â”‚  â”‚  â”‚  â””â”€ Noise subtraction (100ms)
  â”‚  â”‚  â”‚
  â”‚  â”‚  â”œâ”€ Step 19: (700ms)
  â”‚  â”‚  â”‚  â””â”€ [Same as above]
  â”‚  â”‚  â”‚
  â”‚  â”‚  â”œâ”€ Step 18: (700ms)
  â”‚  â”‚  â”‚  â””â”€ [Same as above]
  â”‚  â”‚  â”‚
  â”‚  â”‚  â”œâ”€ ... (steps 17-3)
  â”‚  â”‚  â”‚
  â”‚  â”‚  â”œâ”€ Step 2: (700ms)
  â”‚  â”‚  â”‚  â””â”€ [Same as above]
  â”‚  â”‚  â”‚
  â”‚  â”‚  â””â”€ Step 1: Final denoising (700ms)
  â”‚  â”‚     â””â”€ Clean latent achieved
  â”‚  â”‚
  â”‚  â””â”€ VAE Decoding (200ms)
  â”‚     â””â”€ latent (64Ã—64Ã—4) â†’ image (512Ã—512Ã—3)
  â”‚
T = 15.1s
  â”œâ”€ POST-PROCESSING (100ms)
  â”‚  â”œâ”€ Convert to PIL Image (50ms)
  â”‚  â””â”€ Serialize to PNG bytes (50ms)
  â”‚
T = 15.2s
  â”œâ”€ HTTP RESPONSE (100ms)
  â”‚  â”œâ”€ Set headers
  â”‚  â”‚  â”œâ”€ Content-Type: image/png
  â”‚  â”‚  â””â”€ X-Retrieved-Style: "Cyberpunk"
  â”‚  â””â”€ Send body (PNG bytes)
  â”‚
T = 15.3s
  â”œâ”€ FRONTEND RENDERING (200ms)
  â”‚  â”œâ”€ Receive HTTP response (100ms)
  â”‚  â”œâ”€ Parse PNG bytes (50ms)
  â”‚  â””â”€ Display in Streamlit (50ms)
  â”‚
T = 15.5s
  â””â”€ ğŸ‰ User sees result!

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BREAKDOWN BY COMPONENT                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Network latency:        100ms (1%)                         â”‚
â”‚ RAG retrieval:          100ms (1%)                         â”‚
â”‚ Preprocessing:          100ms (1%)                         â”‚
â”‚ CLIP encoding:          300ms (2%)                         â”‚
â”‚ Diffusion (20 steps):   14s   (93%)  â† BOTTLENECK         â”‚
â”‚ VAE decoding:           200ms (1%)                         â”‚
â”‚ Serialization:          100ms (1%)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TOTAL:                  ~15s (100%)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Memory Layout During Inference

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  GPU MEMORY LAYOUT (T4: 15GB Total)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0GB                                                          15GB    â”‚
â”‚ â”‚                                                              â”‚     â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚ â”‚                  MODEL WEIGHTS (Static)                      â”‚    â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚ â”‚                                                              â”‚     â”‚
â”‚ â”‚ CLIP (Text + Image):      600MB  (float16)                  â”‚     â”‚
â”‚ â”‚ â”œâ”€ Text Transformer:      300MB                             â”‚     â”‚
â”‚ â”‚ â””â”€ Image Transformer:     300MB                             â”‚     â”‚
â”‚ â”‚                                                              â”‚     â”‚
â”‚ â”‚ Stable Diffusion U-Net:   1.7GB  (float16)                  â”‚     â”‚
â”‚ â”‚ â”œâ”€ Encoder blocks:        600MB                             â”‚     â”‚
â”‚ â”‚ â”œâ”€ Bottleneck:            200MB                             â”‚     â”‚
â”‚ â”‚ â””â”€ Decoder blocks:        900MB                             â”‚     â”‚
â”‚ â”‚                                                              â”‚     â”‚
â”‚ â”‚ ControlNet:               720MB  (float16)                  â”‚     â”‚
â”‚ â”‚ â””â”€ Encoder copy:          720MB                             â”‚     â”‚
â”‚ â”‚                                                              â”‚     â”‚
â”‚ â”‚ IP-Adapter:               44MB   (float16)                  â”‚     â”‚
â”‚ â”‚ â””â”€ Attention modifiers:   44MB                              â”‚     â”‚
â”‚ â”‚                                                              â”‚     â”‚
â”‚ â”‚ VAE (Encoder + Decoder):  166MB  (float16)                  â”‚     â”‚
â”‚ â”‚ â”œâ”€ Encoder:               83MB                              â”‚     â”‚
â”‚ â”‚ â””â”€ Decoder:               83MB                              â”‚     â”‚
â”‚ â”‚                                                              â”‚     â”‚
â”‚ â”‚ TOTAL WEIGHTS:            3.2GB                             â”‚     â”‚
â”‚ â”‚                                                              â”‚     â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚ â”‚              ACTIVATION MEMORY (Dynamic)                     â”‚    â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚ â”‚                                                              â”‚     â”‚
â”‚ â”‚ Input latent (64Ã—64Ã—4):   32KB   (float16)                  â”‚     â”‚
â”‚ â”‚                                                              â”‚     â”‚
â”‚ â”‚ U-Net activations (peak): 2.8GB  (float16)                  â”‚     â”‚
â”‚ â”‚ â”œâ”€ Encoder features:      800MB                             â”‚     â”‚
â”‚ â”‚ â”œâ”€ Skip connections:      800MB                             â”‚     â”‚
â”‚ â”‚ â”œâ”€ Attention matrices:    600MB  â† LARGEST                  â”‚     â”‚
â”‚ â”‚ â””â”€ Decoder features:      600MB                             â”‚     â”‚
â”‚ â”‚                                                              â”‚     â”‚
â”‚ â”‚ ControlNet activations:   400MB  (float16)                  â”‚     â”‚
â”‚ â”‚                                                              â”‚     â”‚
â”‚ â”‚ Text embeddings (77Ã—768): 231KB  (float16)                  â”‚     â”‚
â”‚ â”‚                                                              â”‚     â”‚
â”‚ â”‚ Style embeddings (512):   1KB    (float16)                  â”‚     â”‚
â”‚ â”‚                                                              â”‚     â”‚
â”‚ â”‚ TOTAL ACTIVATIONS:        3.2GB                             â”‚     â”‚
â”‚ â”‚                                                              â”‚     â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚ â”‚                   PYTORCH OVERHEAD                           â”‚    â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚ â”‚                                                              â”‚     â”‚
â”‚ â”‚ CUDA context:             500MB                             â”‚     â”‚
â”‚ â”‚ Gradient buffers:         0MB   (inference mode)            â”‚     â”‚
â”‚ â”‚ Memory pool:              100MB                             â”‚     â”‚
â”‚ â”‚                                                              â”‚     â”‚
â”‚ â”‚ TOTAL OVERHEAD:           600MB                             â”‚     â”‚
â”‚ â”‚                                                              â”‚     â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚ â”‚                    SUMMARY                                   â”‚    â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚ â”‚                                                              â”‚     â”‚
â”‚ â”‚ Weights:       3.2GB  (45%)                                 â”‚     â”‚
â”‚ â”‚ Activations:   3.2GB  (45%)                                 â”‚     â”‚
â”‚ â”‚ Overhead:      0.6GB  (10%)                                 â”‚     â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚     â”‚
â”‚ â”‚ TOTAL USED:    7.0GB  (47% of 15GB)                         â”‚     â”‚
â”‚ â”‚                                                              â”‚     â”‚
â”‚ â”‚ Available:     8.0GB  (53%)  â† Headroom for batch size 2   â”‚     â”‚
â”‚ â”‚                                                              â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

WITHOUT OPTIMIZATIONS (float32, attention not sliced):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Weights:       6.4GB  (double)                                      â”‚
â”‚ Activations:   6.4GB  (double)                                      â”‚
â”‚ Overhead:      1.2GB  (double)                                      â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚ TOTAL:         14GB   (93% of 15GB) â† Nearly OOM!                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. CLIP Contrastive Learning

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             CLIP TRAINING (Contrastive Pre-training)                â”‚
â”‚             Dataset: 400M image-text pairs from internet            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TRAINING BATCH (N=32):

Images:                          Texts:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Image 1: Cat    â”‚â”€â”€matchâ”€â”€â”€â”€â”€â”€â”‚ Text 1: "A cat on a sofa"    â”‚
â”‚ Image 2: Dog    â”‚â”€â”€matchâ”€â”€â”€â”€â”€â”€â”‚ Text 2: "A dog playing fetch"â”‚
â”‚ Image 3: Car    â”‚â”€â”€matchâ”€â”€â”€â”€â”€â”€â”‚ Text 3: "Red sports car"     â”‚
â”‚ ...             â”‚              â”‚ ...                          â”‚
â”‚ Image 32: City  â”‚â”€â”€matchâ”€â”€â”€â”€â”€â”€â”‚ Text 32: "Urban cityscape"   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                   â”‚
        â–¼                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Image Encoder    â”‚              â”‚ Text Encoder         â”‚
â”‚ (ViT-B/32)       â”‚              â”‚ (Transformer)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                   â”‚
        â”‚ [32 Ã— 512]                        â”‚ [32 Ã— 512]
        â–¼                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           COSINE SIMILARITY MATRIX (32Ã—32)              â”‚
â”‚                                                         â”‚
â”‚       Text1  Text2  Text3  ...  Text32                  â”‚
â”‚  Img1  0.9   0.2    0.1   ...   0.15   â† High on diag  â”‚
â”‚  Img2  0.1   0.85   0.2   ...   0.12                    â”‚
â”‚  Img3  0.2   0.15   0.88  ...   0.1                     â”‚
â”‚  ...   ...   ...    ...   ...   ...                     â”‚
â”‚  Img32 0.1   0.2    0.15  ...   0.92                    â”‚
â”‚                                                         â”‚
â”‚  Goal: Maximize diagonal (correct pairs)               â”‚
â”‚        Minimize off-diagonal (incorrect pairs)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CONTRASTIVE LOSS                           â”‚
â”‚                                                         â”‚
â”‚  For each image i:                                      â”‚
â”‚    Correct pair: (Img_i, Text_i)                        â”‚
â”‚    Wrong pairs:  (Img_i, Text_j) for j â‰  i             â”‚
â”‚                                                         â”‚
â”‚  Loss = -log( exp(sim(Img_i, Text_i) / Ï„) /            â”‚
â”‚               Î£â±¼ exp(sim(Img_i, Text_j) / Ï„) )         â”‚
â”‚                                                         â”‚
â”‚  where Ï„ = temperature (typically 0.07)                 â”‚
â”‚                                                         â”‚
â”‚  Effect: Pulls correct pairs together,                  â”‚
â”‚          pushes wrong pairs apart in embedding space    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AFTER TRAINING:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SHARED EMBEDDING SPACE (512-dim)           â”‚
â”‚                                                         â”‚
â”‚      ğŸ± "cat"    Image: ğŸ±                             â”‚
â”‚           \      /       (close together)               â”‚
â”‚            \    /                                       â”‚
â”‚             â—â”€â”€â—                                        â”‚
â”‚                                                         â”‚
â”‚                                                         â”‚
â”‚      ğŸš— "car"    Image: ğŸš—                             â”‚
â”‚           \      /       (close together)               â”‚
â”‚            \    /                                       â”‚
â”‚             â—â”€â”€â—                                        â”‚
â”‚                          â†• (far apart)                  â”‚
â”‚                                                         â”‚
â”‚      ğŸ™ï¸ "city"   Image: ğŸ™ï¸                            â”‚
â”‚           \      /       (close together)               â”‚
â”‚            \    /                                       â”‚
â”‚             â—â”€â”€â—                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ZERO-SHOT CAPABILITY:

Query: "futuristic cyberpunk city"  (never seen during training)
  â†“
CLIP Text Encoder
  â†“
Embedding: [0.21, -0.43, 0.69, ...]
  â†“
Nearest neighbor in image embeddings
  â†“
Cyberpunk city image (high similarity)

Works because:
- "futuristic" and "cyberpunk" were in training set
- Compositional understanding from transformer
- Semantic similarity in embedding space
```

---

## 8. Production Scaling Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                PRODUCTION ARCHITECTURE (1000 Users)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

USERS (1000 concurrent)
        â”‚
        â”‚ HTTPS
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CLOUDFLARE CDN                    â”‚
â”‚  â”œâ”€ DDoS protection                      â”‚
â”‚  â”œâ”€ Static asset caching                 â”‚
â”‚  â””â”€ Rate limiting (100 req/sec per IP)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    AWS APPLICATION LOAD BALANCER          â”‚
â”‚  â”œâ”€ Health checks                        â”‚
â”‚  â”œâ”€ SSL termination                      â”‚
â”‚  â””â”€ Request distribution                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼             â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Web      â”‚  â”‚ Web      â”‚  â”‚ Web      â”‚  â”‚ Web      â”‚
â”‚ Server 1 â”‚  â”‚ Server 2 â”‚  â”‚ Server 3 â”‚  â”‚ Server N â”‚
â”‚ (FastAPI)â”‚  â”‚ (FastAPI)â”‚  â”‚ (FastAPI)â”‚  â”‚ (FastAPI)â”‚
â”‚ ECS Task â”‚  â”‚ ECS Task â”‚  â”‚ ECS Task â”‚  â”‚ ECS Task â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚     AMAZON SQS QUEUE          â”‚
        â”‚  (Async job queue)            â”‚
        â”‚  â”œâ”€ FIFO ordering             â”‚
        â”‚  â”œâ”€ DLQ for failures          â”‚
        â”‚  â””â”€ Visibility timeout: 60s   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                           â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GPU Worker 1 â”‚  â”‚ GPU Worker 2 â”‚  â”‚ GPU Worker N â”‚
â”‚ (ECS+GPU)    â”‚  â”‚ (ECS+GPU)    â”‚  â”‚ (ECS+GPU)    â”‚
â”‚ â”œâ”€ SD 1.5    â”‚  â”‚ â”œâ”€ SD 1.5    â”‚  â”‚ â”œâ”€ SD 1.5    â”‚
â”‚ â”œâ”€ ControlNetâ”‚  â”‚ â”œâ”€ ControlNetâ”‚  â”‚ â”œâ”€ ControlNetâ”‚
â”‚ â””â”€ IP-Adapterâ”‚  â”‚ â””â”€ IP-Adapterâ”‚  â”‚ â””â”€ IP-Adapterâ”‚
â”‚              â”‚  â”‚              â”‚  â”‚              â”‚
â”‚ T4 GPU       â”‚  â”‚ T4 GPU       â”‚  â”‚ T4 GPU       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                  â–¼                  â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL   â”‚  â”‚ Redis        â”‚  â”‚ S3 Bucket    â”‚  â”‚ Pinecone     â”‚
â”‚ (RDS)        â”‚  â”‚ (ElastiCache)â”‚  â”‚              â”‚  â”‚ (Vector DB)  â”‚
â”‚              â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚
â”‚ â”œâ”€ Users     â”‚  â”‚ â”œâ”€ Sessions  â”‚  â”‚ â”œâ”€ Generated â”‚  â”‚ â”œâ”€ Style     â”‚
â”‚ â”œâ”€ Jobs      â”‚  â”‚ â”œâ”€ Cache     â”‚  â”‚ â”‚  images    â”‚  â”‚ â”‚  embeddingsâ”‚
â”‚ â”œâ”€ Metrics   â”‚  â”‚ â””â”€ Rate      â”‚  â”‚ â””â”€ User      â”‚  â”‚ â””â”€ Metadata  â”‚
â”‚ â””â”€ Audit logsâ”‚  â”‚    limits    â”‚  â”‚    uploads   â”‚  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

MONITORING STACK:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CloudWatch / Datadog                     â”‚
â”‚ â”œâ”€ GPU utilization                       â”‚
â”‚ â”œâ”€ Queue depth                           â”‚
â”‚ â”œâ”€ Latency percentiles (p50, p95, p99)  â”‚
â”‚ â”œâ”€ Error rates                           â”‚
â”‚ â””â”€ Cost per request                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AUTOSCALING POLICY:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ If queue_depth > 50:                     â”‚
â”‚   scale_up(gpu_workers, +5)              â”‚
â”‚                                          â”‚
â”‚ If queue_depth < 10 for 5 min:           â”‚
â”‚   scale_down(gpu_workers, -5)            â”‚
â”‚                                          â”‚
â”‚ Min workers: 5                           â”‚
â”‚ Max workers: 50                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

COST BREAKDOWN (per month):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 20Ã— T4 GPUs (on-demand):     $5,760     â”‚
â”‚ ALB:                         $30         â”‚
â”‚ ECS tasks (web):             $200        â”‚
â”‚ RDS PostgreSQL (db.r5.large):$200        â”‚
â”‚ ElastiCache Redis:           $150        â”‚
â”‚ S3 + CloudFront:             $100        â”‚
â”‚ Pinecone (serverless):       $70         â”‚
â”‚ Data transfer:               $50         â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚ TOTAL:                       $6,560      â”‚
â”‚                                          â”‚
â”‚ Cost per 1000 users:         $6.56      â”‚
â”‚ Cost per generation:         $0.02       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**These visual diagrams should help you quickly understand and explain the system architecture during your interview! ğŸ¨**
